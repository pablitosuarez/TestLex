package com.base100.lex100.controller.entity.turnoOficina;

import javax.faces.event.ValueChangeEvent;

import org.jboss.seam.annotations.In;
import org.jboss.seam.annotations.Name;
import org.jboss.seam.international.StatusMessage;

import com.base100.expand.json.JSONException;
import com.base100.expand.json.JSONObject;
import com.base100.expand.seam.framework.entity.AbstractEntityHome;
import com.base100.expand.seam.framework.entity.EntityOperationException;
import com.base100.expand.seam.framework.entity.LookupEntitySelectionListener;
import com.base100.lex100.controller.entity.materia.MateriaSearch;
import com.base100.lex100.controller.entity.oficina.OficinaSearch;
import com.base100.lex100.controller.entity.sorteo.SorteoHome;
import com.base100.lex100.entity.Oficina;
import com.base100.lex100.entity.Sorteo;
import com.base100.lex100.entity.TurnoOficina;

/**
 * Class for TurnoOficina Home objects.
 * 
 * Generated by Expand.
 *
 */
@Name("turnoOficinaHome")
public class TurnoOficinaHome extends AbstractEntityHome<TurnoOficina>
{
    @In(create=true)
    private MateriaSearch materiaSearch;
    @In(create=true)
    private OficinaSearch oficinaSearch;
    @In(create=true)
    private SorteoHome sorteoHome;
	private String oficinaCodigo;
	private String oficinaNumero;
    @In(create=true)
    private TurnoOficinaSearch turnoOficinaSearch;

    /**
     * Set/change the entity being managed by id.
     * 
     * @param id new instance id
     */
    public void setTurnoOficinaId(Integer id) {
        setId(id);
    }

    /**
     * Returns the current instance id.
     * 
     * @return the current id.
     */
    public Integer getTurnoOficinaId() {
        return (Integer) getId();
    }

    @Override
    protected void initInstance() {
    	super.initInstance();
		oficinaCodigo = null;
		oficinaNumero = null;
   }

    @Override
    public String doCancel() {
		oficinaCodigo = null;
		oficinaNumero = null;
    	return super.doCancel();
    }

    
    public boolean isWired() {
        return true;
    }

    /**
     * Get the managed entity, or null if the id is not defined.
     * 
     * @return the managed entity, if any.
     */
    public TurnoOficina getDefinedInstance() {
        return isIdDefined() ? getInstance() : null;
    }
 	

    @Override
	public String serializeId(TurnoOficina turnoOficina) {
		JSONObject jsonObject = new JSONObject();
		try {
			jsonObject.put("Id", turnoOficina.getId());
		} catch (JSONException e) {
		}
		return jsonObject.toString(); 
	}

// Lookups


	/**
	 * Action method called from the lookup button/link to select the oficina property.   
	 * 
	 * @param toPage		the page to go
	 * @param returnPage	the page to return after selection was done. 
	 */
	public String lookupOficina(String toPage, String returnPage) {
		oficinaSearch.clear();
		oficinaSearch.setTipoOficina(turnoOficinaSearch.getOficinaTipoOficina());
		oficinaSearch.setShowTipoOficinaFilter((turnoOficinaSearch.getOficinaTipoOficina() == null) ? true: false);
		oficinaSearch.setTipoInstancia(turnoOficinaSearch.getOficinaTipoInstancia());
		oficinaSearch.setShowTipoInstanciaFilter((turnoOficinaSearch.getOficinaTipoInstancia() == null) ? true: false);
		oficinaSearch.setCompetencia(turnoOficinaSearch.getOficinaCompetencia());
		oficinaSearch.setShowCompetenciaFilter((turnoOficinaSearch.getOficinaCompetencia() == null) ? true: false);
		oficinaSearch.updateFilters();
		lookupOficina(returnPage); 
		return toPage;
	}

	/**
	 * Action method called from the lookup button/link to select the oficina property.   
	 * 
	 * @param returnPage	the page to return after selection was done. 
	 */
	public void lookupOficina(String returnPage) {
		initializeLookup(oficinaSearch, new LookupEntitySelectionListener<Oficina>(returnPage, Oficina.class) {
			public void updateLookup(Oficina entity) {
				getInstance().setOficina(entity);
				oficinaCodigo = null;
				oficinaNumero = null;
			}
		});
	}

	public String getOficinaCodigo() {
		if(this.oficinaCodigo == null){
			this.oficinaCodigo = (getInstance().getOficina() != null)? getInstance().getOficina().getCodigo(): null;
		}
		return this.oficinaCodigo;
	}

	public void setOficinaCodigo(String oficinaCodigo) {
		this.oficinaCodigo = oficinaCodigo;
	}

	public void onChangeOficinaCodigo(ValueChangeEvent event) {
		setOficinaCodigo((String)(event.getNewValue()));
		updateOficina();
	}
	
	public String getOficinaNumero() {
		if(this.oficinaNumero == null){
			this.oficinaNumero = (getInstance().getOficina() != null)? getInstance().getOficina().getNumero(): null;
		}
		return this.oficinaNumero;
	}

	public void setOficinaNumero(String oficinaNumero) {
		this.oficinaNumero = oficinaNumero;
	}

	public void onChangeOficinaNumero(ValueChangeEvent event) {
		setOficinaNumero((String)(event.getNewValue()));
		updateOficina();
	}
	
	private void updateOficina() {
		getInstance().setOficina(oficinaSearch.findByNaturalKey(this.oficinaCodigo));
	}



// Validation

// Operation event callbacks

	@Override
	public void afterSelect(){
	}

	@Override
	public void afterNew(TurnoOficina turnoOficina) {
        Sorteo sorteo=sorteoHome.getDefinedInstance();
        if ( sorteo!=null )
        {
			turnoOficina.setSorteo(sorteo);

        }
        
        // settings of default values for properties can be inserted here

	}

	private boolean checkRequired(TurnoOficina turnoOficina) {
		boolean error = false;
		if (turnoOficina.getDesdeFecha() == null) {
			error = true;
			addStatusMessage(StatusMessage.Severity.ERROR, "#{messages['turnoOficina.desdeFecha']} :" + org.jboss.seam.international.Messages.instance().get("error_notnull"));
		}
		if (turnoOficina.getHastaFecha() == null) {
			error = true;
			addStatusMessage(StatusMessage.Severity.ERROR, "#{messages['turnoOficina.hastaFecha']} :" + org.jboss.seam.international.Messages.instance().get("error_notnull"));
		}
		if (turnoOficina.getOficina() == null) {
			error = true;
			addStatusMessage(StatusMessage.Severity.ERROR, "#{messages['turnoOficina.oficina']} :" + org.jboss.seam.international.Messages.instance().get("error_notnull"));
		}
		return error;
	}

	@Override
	public void beforeAdd(TurnoOficina turnoOficina) throws EntityOperationException {
		boolean error = false;
		if (turnoOficinaSearch.findByUuid(turnoOficina.getUuid()) != null){
			error = true;
			addStatusMessage(StatusMessage.Severity.ERROR, org.jboss.seam.international.Messages.instance().get("error_duplicated_id") + " ("  + "UUID" + ")");
		}

		error |= checkRequired(turnoOficina);
		if (error) {
			throw new EntityOperationException();
		}
	}
	
	@Override
	public void beforeUpdate(TurnoOficina turnoOficina) throws EntityOperationException {
		boolean error = false;
		error |= checkRequired(turnoOficina);
		if (error) {
			throw new EntityOperationException();
		}
	}
	
	@Override
	public void beforeDelete(TurnoOficina turnoOficina) throws EntityOperationException {
	}

	@Override
	public void afterAdd(TurnoOficina turnoOficina) throws EntityOperationException {
	}


	@Override
	public void afterUpdate(TurnoOficina turnoOficina) throws EntityOperationException {
	}
	
	@Override
	public void afterDelete(TurnoOficina turnoOficina) throws EntityOperationException {
	}



}

